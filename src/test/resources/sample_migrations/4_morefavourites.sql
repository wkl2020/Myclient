--add UPDATED to videos
DROP VIEW "VIDEOS";
CREATE VIEW IF NOT EXISTS "VIDEOS" AS SELECT VIDEOS_RAW._id as _id, VIDEOS_RAW.REF_ID, VIDEOS_RAW.LANGUAGE_ID, VIDEOS_RAW.STREAM_ID, VIDEOS_RAW.PROGRAM_ID, VIDEOS_RAW.TYPE, VIDEOS_RAW.TITLE, VIDEOS_RAW.TEXT, VIDEOS_RAW.SUBTITLE, VIDEOS_RAW.DURATION, VIDEOS_RAW.THUMBNAIL_URL, VIDEOS_RAW.POSITION, VIDEOS_RAW.DATE, VIDEOS_RAW.RIGHTS_AFTER, VIDEOS_RAW.RIGHTS_UNTIL, VIDEOS_RAW.ADULT, VIDEOS_RAW.WARNING, VIDEOS_RAW.VIDEO_VIEWS, VIDEOS_RAW.RATING, VIDEOS_RAW.RECOMMENDED, VIDEOS_RAW.PLUS7_TEASER, VIDEOS_RAW.RANK, VIDEOS_RAW.GEO_BLOCKING, VIDEOS_RAW.GEO_BLOCKING_ORD, VIDEOS_RAW.ISO_LANG, VIDEOS_RAW.WATCH_POSITION, PROGRAMS.TITLE AS PROGRAM_TITLE, BROADCASTS.MAIN_CLUSTER_ID AS CLUSTER_ID, VIDEOS_RAW.UPDATED FROM VIDEOS_RAW OUTER LEFT JOIN PROGRAMS ON VIDEOS_RAW.PROGRAM_ID = PROGRAMS.PROGRAM_ID AND VIDEOS_RAW.LANGUAGE_ID = PROGRAMS.LANGUAGE_ID OUTER LEFT JOIN BROADCASTS ON BROADCASTS.PROGRAM_ID = PROGRAMS.PROGRAM_ID AND PROGRAMS.LANGUAGE_ID = BROADCASTS.LANGUAGE_ID GROUP BY VIDEOS_RAW.REF_ID;

--add broadcast air time and video rights
DROP VIEW "FAVOURITES_LATEST";
CREATE VIEW IF NOT EXISTS "FAVOURITES_LATEST" AS SELECT DISTINCT FAVOURITES._id, PROGRAMS.TITLE, PROGRAMS.SUBTITLE, PROGRAMS.PROGRAM_ID, PROGRAMS.LANGUAGE_ID, BROADCASTS.AIR_TIME, BROADCASTS.AIR_DATE, IMAGES.URL, CLUSTERS.CLUSTER_ID, FAVOURITES.WATCH_POSITION, VIDEOS.DURATION, VIDEOS.TYPE, VIDEOS.VIDEO_VIEWS, VIDEOS.RIGHTS_AFTER, VIDEOS.RIGHTS_UNTIL FROM FAVOURITES INNER JOIN PROGRAMS ON FAVOURITES.PROGRAM_ID = PROGRAMS.PROGRAM_ID AND FAVOURITES.LANGUAGE_ID = PROGRAMS.LANGUAGE_ID INNER JOIN VIDEOS ON PROGRAMS.DEFAULT_VIDEO_ID = VIDEOS.REF_ID LEFT OUTER JOIN BROADCASTS ON FAVOURITES.PROGRAM_ID = BROADCASTS.PROGRAM_ID AND FAVOURITES.LANGUAGE_ID = BROADCASTS.LANGUAGE_ID LEFT OUTER JOIN IMAGES ON PROGRAMS.DEFAULT_IMAGE_ID = IMAGES.IMAGE_ID LEFT OUTER JOIN CLUSTERS ON BROADCASTS.MAIN_CLUSTER_ID = CLUSTERS.CLUSTER_ID GROUP BY PROGRAMS.PROGRAM_ID;

DROP VIEW "ALREADY_WATCHED";
CREATE VIEW IF NOT EXISTS "ALREADY_WATCHED" AS SELECT DISTINCT PROGRAMS._id, PROGRAMS.TITLE, PROGRAMS.SUBTITLE, PROGRAMS.PROGRAM_ID, PROGRAMS.LANGUAGE_ID, BROADCASTS.AIR_TIME, BROADCASTS.AIR_DATE, IMAGES.URL, CLUSTERS.CLUSTER_ID, VIDEOS.WATCH_POSITION, VIDEOS.DURATION, VIDEOS.TYPE, VIDEOS.VIDEO_VIEWS, VIDEOS.RIGHTS_AFTER, VIDEOS.RIGHTS_UNTIL FROM PROGRAMS INNER JOIN VIDEOS ON PROGRAMS.DEFAULT_VIDEO_ID = VIDEOS.REF_ID LEFT OUTER JOIN BROADCASTS ON PROGRAMS.PROGRAM_ID = BROADCASTS.PROGRAM_ID AND PROGRAMS.LANGUAGE_ID = BROADCASTS.LANGUAGE_ID LEFT OUTER JOIN IMAGES ON PROGRAMS.DEFAULT_IMAGE_ID = IMAGES.IMAGE_ID LEFT OUTER JOIN CLUSTERS ON BROADCASTS.MAIN_CLUSTER_ID = CLUSTERS.CLUSTER_ID GROUP BY PROGRAMS.PROGRAM_ID HAVING VIDEOS.WATCH_POSITION > 0 ORDER BY VIDEOS.UPDATED ASC;